<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPECIAL COUPON TICKET</title>
    <style>
        /* çŸ¢æ²¢ã‚ã„é¢¨ã®ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
            font-family: 'Arial Black', Gadget, sans-serif; /* ã‚¯ãƒ¼ãƒ«ãªãƒ•ã‚©ãƒ³ãƒˆ */
            background-color: #f0f0f0; 
        }

        /* èƒŒæ™¯ç”»åƒã®è¨­å®š */
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('bg_rose.jpg'); /* â˜…ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å…¥ã‚Œã¦ãã ã•ã„â˜… */
            background-size: cover;
            background-position: center;
            filter: grayscale(80%) contrast(150%); /* ãƒ¢ãƒã‚¯ãƒ­æ¼«ç”»é¢¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */
        }

        /* èŠ±ã³ã‚‰UIã®ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ */
        #coupon-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none; /* æœ€åˆã¯éè¡¨ç¤º */
            background-color: rgba(0, 0, 0, 0.5); /* é¸æŠæ™‚ã«æš—ããªã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
            z-index: 10;
        }

        /* ã‚¯ãƒ¼ãƒãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆèŠ±ã³ã‚‰ã®ä»£ã‚ã‚Šã«ä¸­å¤®ã«è¡¨ç¤ºï¼‰ */
        .coupon-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 40px;
            background-color: rgba(180, 0, 0, 0.85); /* æ·±ã„èµ¤ã®èŠ±ã³ã‚‰è‰² */
            color: #fff;
            border: 3px solid #fff;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.7);
            text-align: center;
            border-radius: 10px; /* è§’ã‚’ä¸¸ã */
        }

        .coupon-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 2px 2px #000;
        }
        
        /* YES/NO ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .action-button {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            margin: 0 15px;
            border: 2px solid #fff;
            background-color: transparent;
            color: #fff;
            transition: background-color 0.3s, color 0.3s;
        }

        .action-button:hover {
            background-color: #fff;
            color: #b00;
        }

        /* å®Œäº†ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #completion-ui {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            color: #fff;
            text-align: center;
            padding-top: 40vh;
            z-index: 20;
        }
        #completion-ui h1 { color: #f00; }
    </style>
</head>
<body>

    <div class="background-container"></div>

    <div id="initial-message" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #fff; z-index: 5;">
        <h1 style="font-size: 3em; text-shadow: 2px 2px #000;">Tap a rose petal to reveal your destiny.</h1>
        <p style="text-align: center; font-size: 1.2em; cursor: pointer;" onclick="showCoupon('MEET_U', 'ä¼šã„ã«ãã¦åˆ¸', 'ä¼šãˆã‚‹æ—¥ã‚’èª¿æ•´ã—ã¦ã»ã—ã„');">ã‚¿ãƒƒãƒ—ã—ã¦ã‚¯ãƒ¼ãƒãƒ³ã‚’è¦‹ã‚‹ (ä»®)</p>
    </div>

    <div id="coupon-ui">
        <div class="coupon-display">
            <div class="coupon-title" id="ui-coupon-name"></div>
            <p id="ui-coupon-details" style="margin-bottom: 30px; font-style: italic;">ä½¿ç”¨ã—ã¾ã™ã‹ï¼Ÿ</p>
            <button class="action-button" onclick="confirmUse(true)">YES</button>
            <button class="action-button" onclick="confirmUse(false)">NO</button>
        </div>
    </div>

    <div id="completion-ui">
        <h1>å¼•ãæ›ãˆå®Œäº†ã—ã¾ã—ãŸğŸŒ¹</h1>
        <p style="font-size: 1.5em; color: #ccc;">ã‚ãªãŸã‹ã‚‰ã®é€£çµ¡ã‚’å¿ƒå¾…ã¡ã«ã—ã¦ã„ã¾ã™...</p>
        <p style="font-size: 1.0em; color: #666; margin-top: 50px;">(ã“ã®ç”»é¢ã‚’é–‰ã˜ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™)</p>
    </div>
    
    <script>
        // ã€é‡è¦ã€‘Step 1ã§æ±ºå®šã—ãŸIDã¨URLã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„ï¼
        const COUPON_CODE_ID = 'entry.1809304282';
        const REQUEST_DETAIL_ID = 'entry.62765039';
        const TIMESTAMP_ID = 'entry.824458521';
        
        // ã€é‡è¦ã€‘ãƒ•ã‚©ãƒ¼ãƒ ã®åŸºæœ¬URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼ (viewformã‚’formResponseã«å¤‰æ›´)
        const FORM_BASE_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeHRE5ob-I6RskpdFxrNCfeRN4cB03Lf1WKRpmi1I1rWlPe8Q/formResponse?';

        let currentCouponCode = '';
        let currentRequestDetail = '';

        // ã‚¯ãƒ¼ãƒãƒ³UIã®è¡¨ç¤º
        function showCoupon(code, name, detail) {
            currentCouponCode = code;
            currentRequestDetail = detail; // ä»Šå›ã¯å®šå‹æ–‡ãªã—ãªã®ã§ã€ã»ã¼ç©ºæ¬„
            
            document.getElementById('initial-message').style.display = 'none';
            document.getElementById('ui-coupon-name').textContent = name;
            document.getElementById('coupon-ui').style.display = 'block';
        }

        // YES/NOãƒœã‚¿ãƒ³ã®å‡¦ç†
        function confirmUse(isYes) {
            if (isYes) {
                useCoupon(currentCouponCode, currentRequestDetail);
            } else {
                // NOã®å ´åˆã¯UIã‚’éš ã—ã¦åˆæœŸç”»é¢ã«æˆ»ã‚‹ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
                document.getElementById('coupon-ui').style.display = 'none';
                document.getElementById('initial-message').style.display = 'block';
                // ã¾ãŸã¯ window.location.reload(); 
            }
        }

        // è‡ªå‹•é€ä¿¡æ©Ÿèƒ½ (YESãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹)
        function useCoupon(couponCode, requestDetail) {
            // 1. ç¾åœ¨ã®æ—¥æ™‚ã‚’å–å¾—
            const now = new Date();
            const timestamp = now.toLocaleString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            }).replace(/\//g, '/').replace(/ /g, ' '); 

            // 2. è‡ªå‹•é€ä¿¡ç”¨ã®æœ€çµ‚URLã‚’ä½œæˆ
            const finalUrl = 
                FORM_BASE_URL +
                COUPON_CODE_ID + '=' + encodeURIComponent(couponCode) + '&' +
                REQUEST_DETAIL_ID + '=' + encodeURIComponent(requestDetail) + '&' +
                TIMESTAMP_ID + '=' + encodeURIComponent(timestamp) + 
                '&submit=Submit';

            // 3. å…ƒã‚«ãƒã•ã‚“ã«è¦‹ãˆãªã„ã‚ˆã†ã«è‡ªå‹•é€ä¿¡ã‚’å®Ÿè¡Œã—ã€å®Œäº†ç”»é¢ã¸åˆ‡ã‚Šæ›¿ãˆ
            
            // ã€è‡ªå‹•é€ä¿¡å®Ÿè¡Œã€‘: éåŒæœŸã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é€ä¿¡ (å…ƒã‚«ãƒã•ã‚“ã¯ç”»é¢é·ç§»ã—ãªã„)
            // å…ƒã‚«ãƒã•ã‚“ãŒè¦‹ãˆãªã„ã‚ˆã†ã«ã€éè¡¨ç¤ºã®ç”»åƒã¨ã—ã¦URLã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ã®ãŒæœ€ã‚‚ç°¡å˜ãªæ‰‹æ³•
            const img = new Image();
            img.src = finalUrl; // ã“ã‚Œã§ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ãŒé€ä¿¡ã•ã‚Œã€ã‚ãªãŸã«é€šçŸ¥ãŒå±Šãï¼

            // ã€å…ƒã‚«ãƒã•ã‚“å‘ã‘å®Œäº†ç”»é¢è¡¨ç¤ºã€‘
            document.getElementById('coupon-ui').style.display = 'none';
            document.getElementById('completion-ui').style.display = 'block';
        }
    </script>
</body>
</html>